<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Electrical Maintenance Request</title>
<style>
  /* === Body & Background === */
  body, html { margin:0; padding:0; font-family: Arial, sans-serif; overflow-x: hidden; color:#333; }
  .bg-layer { position: fixed; top:0; left:0; width:100%; height:100%; background-size: cover; background-position: center; transition: opacity 2s ease-in-out; z-index:-2; }
  .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: linear-gradient(rgba(255,255,255,0.3), rgba(255,255,255,0.3)); z-index:-1; }

  /* === Slideshow Dots === */
  .dots-container { position: fixed; bottom: 15px; right: 20px; z-index: 2; display:flex; gap:6px; }
  .dot { width:12px; height:12px; border-radius:50%; background: rgba(255,255,255,0.7); cursor:pointer; transition: background 0.3s; }
  .dot.active { background:#0a3d62; }

  /* === Form Container === */
  .container { background: rgba(255,255,255,0.9); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); max-width: 750px; margin:40px auto; padding:25px 35px; border-radius: 10px; box-shadow:0 2px 12px rgba(0,0,0,0.25); position: relative; z-index:1; }
  h1,h2{text-align:center;color:#0a3d62;}
  form{display:grid;gap:15px;}
  label{font-weight:bold;color:#333;}
  input,textarea,select,button{width:100%;padding:10px;font-size:1rem;border:1px solid #ccc;border-radius:6px;box-sizing:border-box;}
  button{background-color:#0a3d62;color:#fff;font-weight:bold;border:none;cursor:pointer;transition:background-color 0.3s;}
  button:hover{background-color:#1e6091;}
  .note{font-size:0.9rem;color:#555;text-align:center;}
  .whatsapp-btn{display:inline-block;text-align:center;background-color:#25D366;color:white;text-decoration:none;padding:10px 20px;border-radius:8px;font-weight:bold;}
  .whatsapp-btn:hover{background-color:#20b358;}

  @media (max-width:768px){.container{margin:20px 15px;padding:20px;}}

  /* === Preview Popup === */
  .preview-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);display:none;justify-content:center;align-items:center;z-index:10;padding:20px;}
  .preview-content{background:#fff;padding:25px;border-radius:10px;max-width:500px;width:100%;overflow-y:auto;max-height:90%;}
  .preview-content h2{margin-top:0;color:#0a3d62;}
  .preview-close{float:right;cursor:pointer;font-size:20px;font-weight:bold;color:#0a3d62;}
  .preview-field{margin-bottom:10px;}
  .preview-field strong{display:inline-block;width:150px;}

  /* === Gallery === */
  .gallery{background-color:#fff; max-width:900px;margin:40px auto;padding:20px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
  .gallery h2{text-align:center;color:#0a3d62;}
  .gallery-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:15px;}
  .gallery-grid img{width:100%;border-radius:8px;cursor:pointer;transition:transform 0.3s ease;}
  .gallery-grid img:hover{transform:scale(1.05);}
  .lightbox-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);display:none;justify-content:center;align-items:center;z-index:1000;flex-direction:column;}
  .lightbox-overlay img{max-width:90%;max-height:80%;border-radius:10px;}
  .lightbox-overlay span{color:white;cursor:pointer;user-select:none;}
  #lightbox-caption{color:white;margin-top:15px;font-size:18px;text-align:center;}
</style>
</head>
<body>

<!-- Background -->
<div class="bg-layer" id="bg1"></div>
<div class="bg-layer" id="bg2"></div>
<div class="overlay"></div>
<div class="dots-container" id="dotsContainer"></div>

<div class="container">
  <h1>Request Electrical Maintenance</h1>
  <p class="note">Fill the form and preview your submission before sending.</p>

  <form id="maintForm">
    <label for="user_name">Full Name</label>
    <input type="text" id="user_name" name="user_name" placeholder="Enter full name" required />

    <label for="user_email">Email</label>
    <input type="email" id="user_email" name="user_email" placeholder="Enter email" required />

    <label for="user_phone">Phone</label>
    <input type="tel" id="user_phone" name="user_phone" placeholder="Enter phone number" required />

    <label for="user_address">Address</label>
    <input type="text" id="user_address" name="user_address" placeholder="Enter address" required />

    <label for="maintenance_type">Maintenance Type</label>
    <select id="maintenance_type" name="maintenance_type" required>
      <option value="">-- Select --</option>
      <option value="Wiring fault / repair">Wiring fault / repair</option>
      <option value="Rewiring / new connection">Rewiring / new connection</option>
      <option value="Lighting / fan installation">Lighting / fan installation</option>
      <option value="Fuse box / circuit breaker">Fuse box / circuit breaker</option>
      <option value="Generator / inverter">Generator / inverter</option>
      <option value="Solar PV / battery system">Solar PV / battery system</option>
      <option value="Appliance connection">Appliance connection</option>
      <option value="Other">Other</option>
    </select>

    <label for="preferred_datetime">Preferred Date & Time</label>
    <input type="datetime-local" id="preferred_datetime" name="preferred_datetime" />

    <label for="audience_level">Priority Level</label>
    <select id="audience_level" name="audience_level" required>
      <option value="">-- Select Priority --</option>
      <option value="Low">Low</option>
      <option value="Medium">Medium</option>
      <option value="High">High</option>
    </select>

    <label for="message">Details</label>
    <textarea id="message" name="message" rows="4" placeholder="Describe problem..."></textarea>

    <button type="button" id="previewBtn">Preview Request</button>
    <button type="submit">Send Request</button>
  </form>

  <p style="text-align:center;margin-top:15px;">
    <a href="https://api.whatsapp.com/send?phone=+233543899210&text=Hello%20Engineer%2C%20I%20want%20to%20book%20maintenance." 
       target="_blank" class="whatsapp-btn">ðŸ’¬ Chat on WhatsApp</a>
  </p>

  <p class="note" id="statusMsg"></p>
</div>

<!-- Preview Popup -->
<div class="preview-overlay" id="previewOverlay">
  <div class="preview-content">
    <span class="preview-close" id="previewClose">&times;</span>
    <h2>Preview Your Request</h2>
    <div id="previewFields"></div>
    <button id="previewSend">Send Request</button>
  </div>
</div>

<!-- Gallery -->
<div class="gallery">
  <h2>Our Maintenance Work Gallery</h2>
  <div class="gallery-grid">
    <img src="https://images.unsplash.com/photo-1517245386807-8e87d23a4c68?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Wiring Work" />
    <img src="https://images.unsplash.com/photo-1581093588401-ec886b43d2d7?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Lighting Installation" />
    <img src="https://images.unsplash.com/photo-1626364453446-eff724cddae8?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Solar PV Setup" />
    <img src="https://images.unsplash.com/photo-1593642532006-fcb2d0c50aa7?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" alt="Generator Service" />
  </div>
</div>

<!-- Lightbox -->
<div class="lightbox-overlay" id="lightbox">
  <span id="lightbox-close" style="position:absolute;top:15px;right:25px;font-size:30px;">&times;</span>
  <img src="" alt="Full view" id="lightbox-img" />
  <div id="lightbox-caption"></div>
  <span id="prev" style="position:absolute;top:50%;left:15px;font-size:50px;">&#10094;</span>
  <span id="next" style="position:absolute;top:50%;right:15px;font-size:50px;">&#10095;</span>
</div>

<!-- EmailJS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
emailjs.init("ESnv2lhT7rGE36qUV"); // Replace with your public key

// === Background Slideshow ===
const bgImages = [
"https://images.unsplash.com/photo-1517245386807-8e87d23a4c68?ixlib=rb-4.0.3&auto=format&fit=crop&w=1500&q=80",
"https://images.unsplash.com/photo-1581093588401-ec886b43d2d7?ixlib=rb-4.0.3&auto=format&fit=crop&w=1500&q=80",
"https://images.unsplash.com/photo-1626364453446-eff724cddae8?ixlib=rb-4.0.3&auto=format&fit=crop&w=1500&q=80",
"https://images.unsplash.com/photo-1593642532006-fcb2d0c50aa7?ixlib=rb-4.0.3&auto=format&fit=crop&w=1500&q=80"
];
let current=0;
const bg1=document.getElementById('bg1');
const bg2=document.getElementById('bg2');
bg1.style.opacity=1;
bg1.style.backgroundImage=url('${bgImages[0]}');
bg2.style.opacity=0;

const dotsContainer=document.getElementById('dotsContainer');
bgImages.forEach((_,i)=>{const dot=document.createElement('div');dot.classList.add('dot');if(i===0)dot.classList.add('active');dotsContainer.appendChild(dot);dot.addEventListener('click',()=>{current=i-1;switchBackground();});});
const dots=document.querySelectorAll('.dot');
function updateDots(index){dots.forEach(d=>d.classList.remove('active'));dots[index].classList.add('active');}
function switchBackground(){const next=(current+1)%bgImages.length;bg2.style.backgroundImage=url('${bgImages[next]}');bg2.style.opacity=1;setTimeout(()=>{bg1.style.backgroundImage=bgImages[next];bg2.style.opacity=0;current=next;updateDots(current);},2000);}
setInterval(switchBackground,60000);

// === Form & Preview ===
const form=document.getElementById("maintForm");
const statusMsg=document.getElementById("statusMsg");
const previewOverlay=document.getElementById("previewOverlay");
const previewFields=document.getElementById("previewFields");
const previewClose=document.getElementById("previewClose");
const previewBtn=document.getElementById("previewBtn");
const previewSend=document.getElementById("previewSend");

previewBtn.addEventListener('click',()=>{
  previewFields.innerHTML=`
    <div class="preview-field"><strong>Full Name:</strong> ${form.user_name.value}</div>
    <div class="preview-field"><strong>Email:</strong> ${form.user_email.value}</div>
    <div class="preview-field"><strong>Phone:</strong> ${form.user_phone.value}</div>
    <div class="preview-field"><strong>Address:</strong> ${form.user_address.value}</div>
    <div class="preview-field"><strong>Maintenance Type:</strong> ${form.maintenance_type.value}</div>
    <div class="preview-field"><strong>Preferred Date & Time:</strong> ${form.preferred_datetime.value}</div>
    <div class="preview-field"><strong>Priority:</strong> ${form.audience_level.value}</div>
    <div class="preview-field"><strong>Details:</strong> ${form.message.value}</div>
  `;
  previewOverlay.style.display='flex';
});
previewClose.addEventListener('click',()=>previewOverlay.style.display='none');
previewOverlay.addEventListener('click',e=>{if(e.target===previewOverlay)previewOverlay.style.display='none';});
previewSend.addEventListener('click',()=>form.requestSubmit());

form.addEventListener("submit",function(e){
  e.preventDefault();
  statusMsg.textContent="Sending request...";
  statusMsg.style.color="#444";

  const serviceID="service_gjmaqfe"; 
  const templateID="template_7w83any"; 
  const formData=new FormData(form);
  const templateParams=Object.fromEntries(formData.entries());

  emailjs.send(serviceID,templateID,templateParams)
  .then(()=>{statusMsg.textContent="âœ… Request sent successfully!";statusMsg.style.color="green";form.reset();previewOverlay.style.display='none';})
  .catch(err=>{console.error(err);statusMsg.textContent="âŒ Failed to send. Check console.";statusMsg.style.color="red";});
});

// === Gallery Lightbox ===
const lightbox=document.getElementById("lightbox");
const lightboxImg=document.getElementById("lightbox-img");
const lightboxCaption=document.getElementById("lightbox-caption");
const images=document.querySelectorAll(".gallery-grid img");
let currentIndex=0;
function openLightbox(index){currentIndex=index;const img=images[currentIndex];lightboxImg.src=img.src;lightboxCaption.textContent=img.alt||"";lightbox.style.display="flex";}
images.forEach((img,index)=>{img.addEventListener("click",()=>openLightbox(index));});
document.getElementById("lightbox-close").addEventListener("click",()=>lightbox.style.display="none");
document.getElementById("prev").addEventListener("click",e=>{e.stopPropagation();openLightbox((currentIndex-1+images.length)%images.length);});
document.getElementById("next").addEventListener("click",e=>{e.stopPropagation();openLightbox((currentIndex+1)%images.length);});
lightbox.addEventListener("click",e=>{if(e.target===lightbox)lightbox.style.display="none";});
document.addEventListener("keydown",e=>{if(lightbox.style.display==="flex"){if(e.key==="ArrowLeft")openLightbox((currentIndex-1+images.length)%images.length);else if(e.key==="ArrowRight")openLightbox((currentIndex+1)%images.length);else if(e.key==="Escape")lightbox.style.display="none";}});
</script>
</body>
</html>